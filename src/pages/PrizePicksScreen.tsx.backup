// src/pages/PrizePicksScreen.tsx
import React, { useState, useEffect } from 'react';
import {
  Box,
  Typography,
  Grid,
  Card,
  CardContent,
  Button,
  Container,
  Paper,
  Chip,
  IconButton,
  TextField,
  InputAdornment,
  LinearProgress,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Divider,
  Avatar,
  Tooltip,
  Badge,
  Fade,
  CardActions,
  Stack,
  CircularProgress,
  Alert,
  alpha,
  useTheme,
  Tabs,
  Tab,
  Fab,
  Stepper,
  Step,
  StepLabel,
  StepContent,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  ListItemAvatar,
  Breadcrumbs,
  Link as MuiLink,
  Pagination,
  Switch,
  FormControlLabel,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
} from '@mui/material';
import {
  ArrowBack as ArrowBackIcon,
  Search as SearchIcon,
  EmojiEvents as TrophyIcon,
  TrendingUp as TrendingUpIcon,
  Analytics as AnalyticsIcon,
  CheckCircle as CheckCircleIcon,
  Warning as WarningIcon,
  SportsBasketball as BasketballIcon,
  SportsFootball as FootballIcon,
  SportsBaseball as BaseballIcon,
  SportsHockey as HockeyIcon,
  SportsSoccer as SoccerIcon,
  AccessTime as TimeIcon,
  PlayArrow as PlayIcon,
  Bookmark as BookmarkIcon,
  Lightbulb as LightbulbIcon,
  Security as ShieldIcon,
  Diamond as DiamondIcon,
  Refresh as RefreshIcon,
  FilterList as FilterIcon,
  ExpandMore as ExpandMoreIcon,
  AttachMoney as MoneyIcon,
  Star as StarIcon,
  LocalFireDepartment as FireIcon,
  EmojiEvents as EventsIcon,
  Timeline as TimelineIcon,
  Speed as SpeedIcon,
  AutoAwesome as AutoAwesomeIcon,
} from '@mui/icons-material';
import { Link as RouterLink, useNavigate } from 'react-router-dom';
import { styled } from '@mui/material/styles';

// Styled Components
const GradientPaper = styled(Paper)(({ theme }) => ({
  background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 100%)`,
  color: theme.palette.primary.contrastText,
  borderRadius: theme.shape.borderRadius * 2,
}));

const StyledCard = styled(Card)(({ theme }) => ({
  borderRadius: theme.shape.borderRadius * 2,
  transition: 'transform 0.2s, box-shadow 0.2s',
  '&:hover': {
    transform: 'translateY(-4px)',
    boxShadow: theme.shadows[8],
  },
}));

const WinnerBadge = styled(Chip)(({ theme }) => ({
  backgroundColor: theme.palette.success.main,
  color: theme.palette.success.contrastText,
  fontWeight: 'bold',
  fontSize: '0.75rem',
}));

// ConfidenceBadge with custom interface
interface ConfidenceBadgeProps {
  confidence: number;
  label: string;
  size?: 'small' | 'medium';
  className?: string;
}

const ConfidenceBadge: React.FC<ConfidenceBadgeProps> = ({ confidence, label, size = 'medium', className }) => {
  const theme = useTheme();
  
  const getColor = () => {
    if (confidence >= 75) return theme.palette.success.main;
    if (confidence >= 65) return theme.palette.warning.main;
    return theme.palette.error.main;
  };
  
  return (
    <Chip
      label={label}
      size={size}
      sx={{
        backgroundColor: getColor(),
        color: 'white',
        fontWeight: 'bold',
      }}
      className={className}
    />
  );
};

// Mock Data Types
interface Winner {
  player: string;
  pick: string;
  odds: string;
}

interface Selection {
  id: string;
  type: string;
  sport: string;
  title: string;
  confidence: number;
  winners: Winner[];
  totalOdds: string;
  analysis: string;
  timestamp: string;
  model: string;
  modelAccuracy: string;
  edgeScore: number;
  bumpRisk: string;
  payoutMultiplier: string;
  requiresPremium: boolean;
}

// Daily PrizePicks Generator Component
interface DailyPrizePicksGeneratorProps {
  onGenerate?: () => void;
  isGenerating: boolean;
  selectionsLeft: number;
}

interface DailySelection {
  id: number;
  type: string;
  sport: string;
  title: string;
  confidence: number;
  winners: Array<{ name: string; odds: string; probability: string }>;
  analysis: string;
  totalOdds: string;
  probability: string;
  keyStat: string;
  trend: string;
  timestamp: string;
  edgeScore: number;
  bumpRisk: string;
  payoutMultiplier: string;
}

const DailyPrizePicksGenerator: React.FC<DailyPrizePicksGeneratorProps> = ({ 
  onGenerate, 
  isGenerating, 
  selectionsLeft 
}) => {
  const [generatedToday, setGeneratedToday] = useState(false);
  const [dailySelections, setDailySelections] = useState<DailySelection[]>([]);

  const mockSelections: DailySelection[] = [
    {
      id: 1,
      type: '3-Winner Parlay',
      sport: 'NBA',
      title: 'NBA Triple Threat',
      confidence: 88,
      winners: [
        { name: 'Luka Donƒçiƒá Over 32.5 Points', odds: '-145', probability: '72%' },
        { name: 'Nikola Jokiƒá Over 9.5 Assists', odds: '-120', probability: '68%' },
        { name: 'Jayson Tatum Over 27.5 Points', odds: '-110', probability: '65%' }
      ],
      analysis: 'PrizePicks lines showing value vs sportsbook consensus across all three picks.',
      totalOdds: '+400',
      probability: '35%',
      keyStat: 'Combined edge score: 8.5/10',
      trend: 'NBA parlays hit 60% last 30 days',
      timestamp: 'Today ‚Ä¢ 7:30 PM ET',
      edgeScore: 8.5,
      bumpRisk: 'Medium',
      payoutMultiplier: '5x'
    },
  ];

  const handleGenerate = () => {
    setGeneratedToday(true);
    setDailySelections(mockSelections);
    onGenerate?.();
  };

  return (
    <Paper sx={{ p: 3, mb: 3, bgcolor: 'grey.900', color: 'white', borderRadius: 2 }}>
      <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
        <Box sx={{ display: 'flex', alignItems: 'center' }}>
          <Avatar sx={{ bgcolor: 'primary.main', mr: 2, position: 'relative' }}>
            <TrophyIcon />
            <Badge
              badgeContent={selectionsLeft}
              color="error"
              sx={{
                '& .MuiBadge-badge': {
                  right: -3,
                  top: -3,
                },
              }}
            />
          </Avatar>
          <Box>
            <Typography variant="h6" fontWeight="bold">
              Daily PrizePicks Generator
            </Typography>
            <Typography variant="body2" color="grey.400">
              3 winners per selection ‚Ä¢ 2 selections per day
            </Typography>
          </Box>
        </Box>
        
        <Button
          variant="contained"
          onClick={handleGenerate}
          disabled={generatedToday || isGenerating || selectionsLeft <= 0}
          startIcon={isGenerating ? <CircularProgress size={20} /> : <AutoAwesomeIcon />}
        >
          {selectionsLeft <= 0 ? 'Limit Reached' :
           generatedToday ? 'Generated Today' : 'Generate Selections'}
        </Button>
      </Box>

      {selectionsLeft <= 0 && (
        <Alert severity="warning" sx={{ mb: 2 }}>
          Daily limit reached. Come back tomorrow for 2 more selections.
        </Alert>
      )}

      {dailySelections.length > 0 ? (
        <Box>
          {dailySelections.map((selection) => (
            <Paper key={selection.id} sx={{ p: 2, mb: 2, bgcolor: 'grey.800' }}>
              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
                <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
                  <ConfidenceBadge 
                    label={`${selection.confidence}%`} 
                    confidence={selection.confidence} 
                    size="small" 
                  />
                  <Chip label={selection.type} size="small" color="secondary" />
                  <Chip 
                    label={selection.sport} 
                    size="small" 
                    sx={{ 
                      bgcolor: selection.sport === 'NBA' ? 'error.main' : 
                              selection.sport === 'NFL' ? 'success.main' : 'warning.main',
                      color: 'white'
                    }}
                  />
                </Box>
                <Typography variant="caption" color="grey.400">
                  {selection.timestamp}
                </Typography>
              </Box>

              <Typography variant="h6" fontWeight="bold" gutterBottom>
                {selection.title}
              </Typography>

              <Box sx={{ mb: 2 }}>
                <Typography variant="subtitle2" color="primary" gutterBottom>
                  üéØ 3-Winner Combo:
                </Typography>
                <List dense>
                  {selection.winners.map((winner, index) => (
                    <ListItem key={index} sx={{ py: 0.5 }}>
                      <ListItemAvatar>
                        <Avatar sx={{ bgcolor: 'primary.main', width: 24, height: 24, fontSize: 12 }}>
                          {index + 1}
                        </Avatar>
                      </ListItemAvatar>
                      <ListItemText
                        primary={winner.name}
                        secondary={`${winner.odds} (${winner.probability} prob)`}
                        primaryTypographyProps={{ color: 'white', fontSize: '0.875rem' }}
                        secondaryTypographyProps={{ color: 'grey.400', fontSize: '0.75rem' }}
                      />
                    </ListItem>
                  ))}
                </List>
              </Box>

              <Grid container spacing={2} sx={{ mb: 2 }}>
                <Grid item xs={4}>
                  <Paper sx={{ p: 1, textAlign: 'center', bgcolor: 'grey.700' }}>
                    <Typography variant="caption" color="grey.400">Total Odds</Typography>
                    <Typography variant="h6" color="success.main" fontWeight="bold">
                      {selection.totalOdds}
                    </Typography>
                  </Paper>
                </Grid>
                <Grid item xs={4}>
                  <Paper sx={{ p: 1, textAlign: 'center', bgcolor: 'grey.700' }}>
                    <Typography variant="caption" color="grey.400">Payout</Typography>
                    <Typography variant="h6" color="warning.main" fontWeight="bold">
                      {selection.payoutMultiplier}
                    </Typography>
                  </Paper>
                </Grid>
                <Grid item xs={4}>
                  <Paper sx={{ p: 1, textAlign: 'center', bgcolor: 'grey.700' }}>
                    <Typography variant="caption" color="grey.400">Edge Score</Typography>
                    <Typography variant="h6" color="primary.main" fontWeight="bold">
                      {selection.edgeScore}/10
                    </Typography>
                  </Paper>
                </Grid>
              </Grid>

              <Typography variant="body2" color="grey.300" sx={{ mb: 2, fontStyle: 'italic' }}>
                {selection.analysis}
              </Typography>

              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <Chip
                  icon={selection.bumpRisk === 'High' ? <WarningIcon /> : <ShieldIcon />}
                  label={`Bump Risk: ${selection.bumpRisk}`}
                  size="small"
                  color={selection.bumpRisk === 'High' ? 'error' : 
                         selection.bumpRisk === 'Medium' ? 'warning' : 'success'}
                />
                <Chip
                  icon={<TrendingUpIcon />}
                  label={selection.trend}
                  size="small"
                  sx={{ bgcolor: 'success.light', color: 'success.contrastText' }}
                />
              </Box>
            </Paper>
          ))}
        </Box>
      ) : (
        <Box sx={{ textAlign: 'center', py: 4 }}>
          <Avatar sx={{ bgcolor: 'grey.800', width: 80, height: 80, mb: 2, mx: 'auto', position: 'relative' }}>
            <TrophyIcon sx={{ fontSize: 40, color: 'grey.500' }} />
            <Badge
              badgeContent="3"
              color="primary"
              sx={{
                position: 'absolute',
                top: -10,
                right: -10,
                '& .MuiBadge-badge': {
                  fontSize: 12,
                  height: 24,
                  minWidth: 24,
                },
              }}
            />
          </Avatar>
          <Typography variant="h6" color="grey.400" gutterBottom>
            No PrizePicks generated yet
          </Typography>
          <Typography variant="body2" color="grey.500">
            Each selection contains 3 winners. Generate {selectionsLeft} more selection(s) today.
          </Typography>
        </Box>
      )}

      <Box sx={{ display: 'flex', alignItems: 'center', mt: 2, pt: 2, borderTop: 1, borderColor: 'grey.800' }}>
        <AnalyticsIcon sx={{ fontSize: 16, color: 'primary.main', mr: 1 }} />
        <Typography variant="caption" color="grey.500">
          ‚Ä¢ 3 winners per selection ‚Ä¢ 2 selections daily ‚Ä¢ Line discrepancy analysis
        </Typography>
      </Box>
    </Paper>
  );
};

// Mock Data
const mockSelections: Selection[] = [
  {
    id: '1',
    type: '3-Winner Parlay',
    sport: 'NBA',
    title: 'NBA Star Power Trio',
    confidence: 88,
    winners: [
      { player: 'Luka Donƒçiƒá', pick: 'Over 32.5 Points', odds: '-145' },
      { player: 'Nikola Jokiƒá', pick: 'Over 9.5 Assists', odds: '-120' },
      { player: 'Jayson Tatum', pick: 'Over 27.5 Points', odds: '-110' }
    ],
    totalOdds: '+400',
    analysis: 'Three MVP candidates with favorable matchups. PrizePicks lines undervalued vs sportsbook consensus.',
    timestamp: 'Today, 7:30 PM ET',
    model: 'Line Discrepancy Model',
    modelAccuracy: '82.4%',
    edgeScore: 8.2,
    bumpRisk: 'Medium',
    payoutMultiplier: '5x',
    requiresPremium: false,
  },
  {
    id: '2',
    type: '3-Winner Flex Play',
    sport: 'NFL',
    title: 'NFL Sunday Special',
    confidence: 85,
    winners: [
      { player: 'Christian McCaffrey', pick: 'Over 115.5 Yds', odds: '-155' },
      { player: 'Josh Allen', pick: 'Over 2.5 TDs', odds: '+120' },
      { player: 'Tyreek Hill', pick: 'Over 99.5 Rec Yds', odds: '-130' }
    ],
    totalOdds: '+600',
    analysis: 'High-value NFL player props with low correlation for optimal parlay construction.',
    timestamp: 'Tomorrow, 1:00 PM ET',
    model: 'Matchup Analysis',
    modelAccuracy: '78.2%',
    edgeScore: 7.8,
    bumpRisk: 'Low',
    payoutMultiplier: '7x',
    requiresPremium: true,
  },
];

const selectionQueries = [
  "Generate NBA 3-winner parlays",
  "Best NFL trios this week",
  "High edge PrizePicks with 3 winners",
  "Generate PrizePicks parlays with +EV",
  "Today's 3-winner line discrepancies",
];

const sports = [
  { id: 'All', name: 'All Sports', icon: <TrophyIcon />, color: 'primary' as const },
  { id: 'NBA', name: 'NBA', icon: <BasketballIcon />, color: 'error' as const },
  { id: 'NFL', name: 'NFL', icon: <FootballIcon />, color: 'success' as const },
  { id: 'MLB', name: 'MLB', icon: <BaseballIcon />, color: 'warning' as const },
  { id: 'NHL', name: 'NHL', icon: <HockeyIcon />, color: 'info' as const },
  { id: 'Soccer', name: 'Soccer', icon: <SoccerIcon />, color: 'success' as const },
];

const timeframes = ['Today', 'Tomorrow', 'Week', 'All Upcoming'];

// Main Component
const PrizePicksScreen: React.FC = () => {
  const [analytics, setAnalytics] = useState([]);
  const theme = useTheme();
  const navigate = useNavigate();
  
  const [loading, setLoading] = useState(false);
  const [selectedSport, setSelectedSport] = useState('All');
  const [selectedTimeframe, setSelectedTimeframe] = useState('Today');
  const [searchQuery, setSearchQuery] = useState('');
  const [showSimulationModal, setShowSimulationModal] = useState(false);
  const [simulating, setSimulating] = useState(false);
  const [generatingSelections, setGeneratingSelections] = useState(false);
  const [dailySelectionsLeft, setDailySelectionsLeft] = useState(2);
  const [todaySelections, setTodaySelections] = useState<Selection[]>([]);

  useEffect(() => {
    // Load initial data
    setTodaySelections(mockSelections);
  }, []);

  const handleGenerateSelections = () => {
    if (dailySelectionsLeft <= 0) {
      return;
    }
    
    setGeneratingSelections(true);
    setTimeout(() => {
      setGeneratingSelections(false);
      setDailySelectionsLeft(prev => prev - 1);
    }, 2000);
  };

  const simulateSelection = (selectionId: string) => {
    setSimulating(true);
    setShowSimulationModal(true);
    
    setTimeout(() => {
      setSimulating(false);
    }, 3000);
  };

  const handleSearch = (query: string) => {
    setSearchQuery(query);
  };

  const renderSelectionCard = (selection: Selection) => {
    const getBumpRiskColor = (risk: string) => {
      switch (risk) {
        case 'High': return 'error';
        case 'Medium': return 'warning';
        case 'Low': return 'success';
        default: return 'default';
      }
    };

    const getSportIcon = (sport: string) => {
      switch (sport) {
        case 'NBA': return <BasketballIcon />;
        case 'NFL': return <FootballIcon />;
        case 'MLB': return <BaseballIcon />;
        case 'NHL': return <HockeyIcon />;
        default: return <TrophyIcon />;
      }
    };

    return (
      <StyledCard sx={{ mb: 3 }}>
        <CardContent>
          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
              <Avatar sx={{ bgcolor: 'primary.light', color: 'primary.main' }}>
                {getSportIcon(selection.sport)}
              </Avatar>
              <Box>
                <Typography variant="h6" fontWeight="bold">
                  {selection.title}
                </Typography>
                <Box sx={{ display: 'flex', gap: 1, mt: 0.5 }}>
                  <ConfidenceBadge 
                    label={`${selection.confidence}%`} 
                    confidence={selection.confidence}
                    size="small"
                  />
                  <Chip 
                    label={selection.type} 
                    size="small" 
                    color="secondary"
                    icon={<EventsIcon />}
                  />
                </Box>
              </Box>
            </Box>
            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
              <Chip 
                label={selection.payoutMultiplier}
                size="small"
                color="warning"
                icon={<MoneyIcon />}
              />
            </Box>
          </Box>

          <Box sx={{ mb: 3 }}>
            <Typography variant="subtitle2" color="primary" gutterBottom>
              üéØ 3-Winner Combo:
            </Typography>
            <TableContainer component={Paper} variant="outlined" sx={{ mb: 2 }}>
              <Table size="small">
                <TableHead>
                  <TableRow>
                    <TableCell><Typography variant="caption" fontWeight="bold">Player</Typography></TableCell>
                    <TableCell><Typography variant="caption" fontWeight="bold">Pick</Typography></TableCell>
                    <TableCell align="right"><Typography variant="caption" fontWeight="bold">Odds</Typography></TableCell>
                  </TableRow>
                </TableHead>
                <TableBody>
                  {selection.winners.map((winner, index) => (
                    <TableRow key={index}>
                      <TableCell>
                        <Typography variant="body2" fontWeight="medium">
                          {winner.player}
                        </Typography>
                      </TableCell>
                      <TableCell>
                        <Typography variant="body2" color="text.secondary">
                          {winner.pick}
                        </Typography>
                      </TableCell>
                      <TableCell align="right">
                        <Typography 
                          variant="body2" 
                          fontWeight="bold"
                          color={winner.odds.startsWith('+') ? 'success.main' : 'error.main'}
                        >
                          {winner.odds}
                        </Typography>
                      </TableCell>
                    </TableRow>
                  ))}
                </TableBody>
              </Table>
            </TableContainer>
          </Box>

          <Grid container spacing={2} sx={{ mb: 3 }}>
            <Grid item xs={4}>
              <Paper sx={{ p: 1.5, textAlign: 'center' }}>
                <Typography variant="caption" color="text.secondary">Total Odds</Typography>
                <Typography 
                  variant="h5" 
                  fontWeight="bold"
                  color={selection.totalOdds.startsWith('+') ? 'success.main' : 'error.main'}
                >
                  {selection.totalOdds}
                </Typography>
              </Paper>
            </Grid>
            <Grid item xs={4}>
              <Paper sx={{ p: 1.5, textAlign: 'center' }}>
                <Typography variant="caption" color="text.secondary">Edge Score</Typography>
                <Typography variant="h5" fontWeight="bold" color="primary.main">
                  {selection.edgeScore}/10
                </Typography>
              </Paper>
            </Grid>
            <Grid item xs={4}>
              <Paper sx={{ p: 1.5, textAlign: 'center' }}>
                <Typography variant="caption" color="text.secondary">Bump Risk</Typography>
                <Chip 
                  label={selection.bumpRisk}
                  size="small"
                  color={getBumpRiskColor(selection.bumpRisk)}
                  sx={{ mt: 0.5 }}
                />
              </Paper>
            </Grid>
          </Grid>

          <Paper sx={{ p: 2, bgcolor: 'grey.50', mb: 2 }}>
            <Box sx={{ display: 'flex', alignItems: 'flex-start' }}>
              <LightbulbIcon sx={{ color: 'primary.main', mr: 1, mt: 0.5 }} />
              <Typography variant="body2" color="text.secondary">
                {selection.analysis}
              </Typography>
            </Box>
          </Paper>

          <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
            <Box>
              <Chip
                icon={<AnalyticsIcon />}
                label={`${selection.model} ‚Ä¢ ${selection.modelAccuracy}`}
                size="small"
                variant="outlined"
              />
              <Typography variant="caption" color="text.secondary" sx={{ ml: 2 }}>
                {selection.timestamp}
              </Typography>
            </Box>
            
            <Box sx={{ display: 'flex', gap: 1 }}>
              <Button
                variant="contained"
                size="small"
                startIcon={<PlayIcon />}
                onClick={() => simulateSelection(selection.id)}
              >
                Simulate
              </Button>
              <Button
                variant="outlined"
                size="small"
                startIcon={<BookmarkIcon />}
                onClick={() => {
                  if (selection.requiresPremium) {
                    // Show premium modal
                  } else {
                    // Track selection
                  }
                }}
              >
                Track
              </Button>
            </Box>
          </Box>
        </CardContent>
      </StyledCard>
    );
  };

  const filteredSelections = mockSelections.filter(selection => {
    if (selectedSport !== 'All' && selection.sport !== selectedSport) return false;
    if (searchQuery) {
      const query = searchQuery.toLowerCase();
      return (
        selection.title.toLowerCase().includes(query) ||
        selection.sport.toLowerCase().includes(query) ||
        selection.winners.some(w => 
          w.player.toLowerCase().includes(query) ||
          w.pick.toLowerCase().includes(query)
        )
      );
    }
    return true;
  });

  return (
    <Container maxWidth="lg">
      {/* Header */}
      <Box sx={{ mb: 4, mt: 2 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
          <Button
            component={RouterLink}
            to="/"
            startIcon={<ArrowBackIcon />}
          >
            Back
          </Button>
          
          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
            <TextField
              placeholder="Search PrizePicks..."
              size="small"
              value={searchQuery}
              onChange={(e) => handleSearch(e.target.value)}
              InputProps={{
                startAdornment: (
                  <InputAdornment position="start">
                    <SearchIcon />
                  </InputAdornment>
                ),
              }}
              sx={{ width: 300 }}
            />
            <Button
              startIcon={<RefreshIcon />}
              onClick={() => {
                setSelectedSport('All');
                setSearchQuery('');
              }}
              variant="outlined"
            >
              Reset
            </Button>
          </Box>
        </Box>

        <GradientPaper sx={{ p: 4, textAlign: 'center', position: 'relative' }}>
          <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', mb: 2 }}>
            <Avatar sx={{ bgcolor: 'white', color: 'primary.main', mr: 2, width: 60, height: 60 }}>
              <TrophyIcon sx={{ fontSize: 32 }} />
            </Avatar>
            <Badge
              badgeContent="3"
              color="error"
              sx={{
                '& .MuiBadge-badge': {
                  fontSize: 14,
                  height: 28,
                  minWidth: 28,
                },
              }}
            >
              <Box>
                <Typography variant="h3" fontWeight="bold" sx={{ color: 'white' }}>
                  PrizePicks Hub
                </Typography>
                <Typography variant="h6" sx={{ color: 'rgba(255,255,255,0.9)' }}>
                  3 winners per selection ‚Ä¢ 2 selections daily
                </Typography>
              </Box>
            </Badge>
          </Box>
        </GradientPaper>
      </Box>

      {/* Daily Generator */}
      <DailyPrizePicksGenerator 
        onGenerate={handleGenerateSelections}
        isGenerating={generatingSelections}
        selectionsLeft={dailySelectionsLeft}
      />

      {/* Daily Stats */}
      <Grid container spacing={2} sx={{ mb: 3 }}>
        <Grid item xs={4}>
          <Paper sx={{ p: 2, textAlign: 'center' }}>
            <Typography variant="h4" fontWeight="bold" color="primary" gutterBottom>
              {dailySelectionsLeft}
            </Typography>
            <Typography variant="body2" color="text.secondary">
              Selections Left
            </Typography>
          </Paper>
        </Grid>
        <Grid item xs={4}>
          <Paper sx={{ p: 2, textAlign: 'center' }}>
            <Typography variant="h4" fontWeight="bold" color="success.main" gutterBottom>
              3
            </Typography>
            <Typography variant="body2" color="text.secondary">
              Winners per Selection
            </Typography>
          </Paper>
        </Grid>
        <Grid item xs={4}>
          <Paper sx={{ p: 2, textAlign: 'center' }}>
            <Typography variant="h4" fontWeight="bold" color="warning.main" gutterBottom>
              {todaySelections.length * 3}
            </Typography>
            <Typography variant="body2" color="text.secondary">
              Total Winners Today
            </Typography>
          </Paper>
        </Grid>
      </Grid>

      {/* Timeframe Selector */}
      <Paper sx={{ p: 1, mb: 3 }}>
        <Tabs
          value={selectedTimeframe}
          onChange={(e, newValue) => setSelectedTimeframe(newValue)}
          variant="scrollable"
          scrollButtons="auto"
        >
          {timeframes.map((timeframe) => (
            <Tab key={timeframe} label={timeframe} value={timeframe} />
          ))}
        </Tabs>
      </Paper>

      {/* Sport Filter */}
      <Paper sx={{ p: 2, mb: 3 }}>
        <Typography variant="subtitle2" fontWeight="bold" gutterBottom>
          Filter by Sport
        </Typography>
        <Stack direction="row" spacing={1} sx={{ flexWrap: 'wrap', gap: 1 }}>
          {sports.map((sport) => (
            <Chip
              key={sport.id}
              icon={sport.icon}
              label={sport.name}
              onClick={() => setSelectedSport(sport.id)}
              color={selectedSport === sport.id ? sport.color : 'default'}
              variant={selectedSport === sport.id ? 'filled' : 'outlined'}
            />
          ))}
        </Stack>
      </Paper>

      {/* Search Results Info */}
      {searchQuery && (
        <Alert 
          severity="info" 
          action={
            <Button color="inherit" size="small" onClick={() => setSearchQuery('')}>
              Clear
            </Button>
          }
          sx={{ mb: 3 }}
        >
          {filteredSelections.length} of {mockSelections.length} picks match "{searchQuery}"
        </Alert>
      )}

      {/* Quick Search Queries */}
      <Paper sx={{ p: 2, mb: 3 }}>
        <Typography variant="subtitle2" fontWeight="bold" gutterBottom>
          Quick Search
        </Typography>
        <Stack direction="row" spacing={1} sx={{ flexWrap: 'wrap', gap: 1 }}>
          {selectionQueries.map((query, index) => (
            <Chip
              key={index}
              label={query}
              onClick={() => handleSearch(query)}
              variant="outlined"
              size="small"
            />
          ))}
        </Stack>
      </Paper>

      {/* Selections Grid */}
      <Box sx={{ mb: 6 }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>
          <Box>
            <Typography variant="h4" fontWeight="bold">
              üéØ Curated 3-Winner Selections
            </Typography>
            <Typography variant="body1" color="text.secondary">
              Each pick contains 3 winners for maximum value
            </Typography>
          </Box>
          <Chip
            label={`${filteredSelections.length} picks ‚Ä¢ ${selectedTimeframe}`}
            color="primary"
            variant="outlined"
          />
        </Box>

        {filteredSelections.length > 0 ? (
          filteredSelections.map(selection => (
            <Box key={selection.id}>
              {renderSelectionCard(selection)}
            </Box>
          ))
        ) : (
          <Paper sx={{ p: 8, textAlign: 'center' }}>
            <Avatar sx={{ bgcolor: 'grey.100', color: 'grey.500', width: 80, height: 80, mb: 2, mx: 'auto' }}>
              <TrophyIcon sx={{ fontSize: 40 }} />
            </Avatar>
            <Typography variant="h6" color="text.secondary" gutterBottom>
              No PrizePicks found
            </Typography>
            <Typography variant="body2" color="text.secondary">
              {searchQuery ? 'Try a different search or filter' : 'Generate selections or check back later'}
            </Typography>
          </Paper>
        )}
      </Box>

      {/* Simulation Modal */}
      <Dialog
        open={showSimulationModal}
        onClose={() => !simulating && setShowSimulationModal(false)}
        maxWidth="sm"
        fullWidth
      >
        <DialogTitle>
          {simulating ? 'Generating PrizePicks...' : 'PrizePicks Generated!'}
        </DialogTitle>
        <DialogContent>
          {simulating ? (
            <Box sx={{ textAlign: 'center', py: 4 }}>
              <CircularProgress size={60} thickness={4} sx={{ mb: 3 }} />
              <Typography variant="h6" gutterBottom>
                Analyzing 3-winner combinations
              </Typography>
              <Typography variant="body2" color="text.secondary" gutterBottom>
                Calculating edge and optimizing selections
              </Typography>
              
              <Stepper activeStep={2} sx={{ mt: 4 }}>
                <Step>
                  <StepLabel>Loading Data</StepLabel>
                </Step>
                <Step>
                  <StepLabel>Analyzing Lines</StepLabel>
                </Step>
                <Step>
                  <StepLabel>Generating Winners</StepLabel>
                </Step>
              </Stepper>
            </Box>
          ) : (
            <Box sx={{ textAlign: 'center', py: 4 }}>
              <Avatar sx={{ 
                bgcolor: 'success.main', 
                width: 100, 
                height: 100, 
                mb: 3,
                mx: 'auto',
                position: 'relative'
              }}>
                <TrophyIcon sx={{ fontSize: 48 }} />
                <Badge
                  badgeContent="3"
                  color="error"
                  sx={{
                    position: 'absolute',
                    top: -10,
                    right: -10,
                    '& .MuiBadge-badge': {
                      fontSize: 14,
                      height: 30,
                      minWidth: 30,
                    },
                  }}
                />
              </Avatar>
              <Typography variant="h5" fontWeight="bold" gutterBottom>
                3-Winner PrizePicks Generated!
              </Typography>
              <Typography variant="body1" color="text.secondary" gutterBottom>
                {dailySelectionsLeft} selection(s) left today ‚Ä¢ 3 winners per selection
              </Typography>
            </Box>
          )}
        </DialogContent>
        {!simulating && (
          <DialogActions>
            <Button onClick={() => setShowSimulationModal(false)}>
              Close
            </Button>
            <Button variant="contained" onClick={() => setShowSimulationModal(false)}>
              View 3-Winner Picks
            </Button>
          </DialogActions>
        )}
      </Dialog>

      {/* Floating Action Button */}
      <Fab
        color="primary"
        sx={{ position: 'fixed', bottom: 16, right: 16 }}
        onClick={handleGenerateSelections}
        disabled={generatingSelections || dailySelectionsLeft <= 0}
      >
        {generatingSelections ? <CircularProgress size={24} color="inherit" /> : <AutoAwesomeIcon />}
      </Fab>
    </Container>
  );
};

export default PrizePicksScreen;

// ===== ADDED: PrizePicks Analytics API Call =====
useEffect(() => {
  const fetchPrizePicksAnalytics = async () => {
    try {
      const response = await fetch(`${process.env.VITE_API_URL}/api/prizepicks/analytics`);
      if (response.ok) {
        const data = await response.json();
        console.log("üìà PrizePicks Analytics response:", data);
        
        // Handle both array and object formats
        let analyticsData = [];
        if (data.analytics) {
          if (Array.isArray(data.analytics)) {
            analyticsData = data.analytics;
          } else if (typeof data.analytics === 'object') {
            // Extract from nested structure
            if (data.analytics.bySport && Array.isArray(data.analytics.bySport)) {
              analyticsData.push(...data.analytics.bySport);
            }
            if (data.analytics.topPerformers && Array.isArray(data.analytics.topPerformers)) {
              analyticsData.push(...data.analytics.topPerformers);
            }
            if (data.analytics.byPickType && Array.isArray(data.analytics.byPickType)) {
              analyticsData.push(...data.analytics.byPickType);
            }
          }
        }
        
        console.log(`‚úÖ Extracted ${analyticsData.length} analytics items`);
        setAnalytics(analyticsData);
      }
    } catch (error) {
      console.error("Error fetching PrizePicks analytics:", error);
    }
  };
  
  fetchPrizePicksAnalytics();
}, []);
