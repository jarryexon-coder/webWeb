// src/pages/SecretPhraseScreen.tsx
import React, { useState, useEffect, useCallback } from 'react';
import {
  Box,
  Typography,
  Grid,
  Card,
  CardContent,
  Button,
  Container,
  Paper,
  Chip,
  IconButton,
  TextField,
  InputAdornment,
  LinearProgress,
  Dialog,
  DialogTitle,
  DialogContent,
  DialogActions,
  Divider,
  Avatar,
  Tooltip,
  Badge,
  Fade,
  Collapse,
  List,
  ListItem,
  ListItemIcon,
  ListItemText,
  Accordion,
  AccordionSummary,
  AccordionDetails,
  CardActions,
  Stack,
  CircularProgress,
  Alert,
  alpha,
  useTheme,
  Tabs,
  Tab,
  Fab,
  Drawer,
  Menu,
  MenuItem,
  ListItemAvatar,
  Breadcrumbs,
  Link as MuiLink,
  Pagination,
  Rating,
  Switch,
  FormControlLabel,
  Stepper,
  Step,
  StepLabel,
  StepContent,
  Timeline,
  TimelineItem,
  TimelineSeparator,
  TimelineDot,
  TimelineConnector,
  TimelineContent,
  TimelineOppositeContent,
} from '@mui/material';
import {
  Search as SearchIcon,
  ArrowBack as ArrowBackIcon,
  Diamond as DiamondIcon,
  Analytics as AnalyticsIcon,
  TrendingUp as TrendingUpIcon,
  FlashOn as FlashIcon,
  TrendingUp as StatsIcon,
  Book as BookIcon,
  AutoAwesome as SparklesIcon,
  History as HistoryIcon,
  Key as KeyIcon,
  RocketLaunch as RocketIcon,
  CopyAll as CopyIcon,
  Lightbulb as LightbulbIcon,
  Security as ShieldIcon,
  CheckCircle as CheckCircleIcon,
  Warning as WarningIcon,
  Info as InfoIcon,
  Close as CloseIcon,
  ExpandMore as ExpandMoreIcon,
  SportsBasketball as BasketballIcon,
  SportsFootball as FootballIcon,
  SportsHockey as HockeyIcon,
  SportsBaseball as BaseballIcon,
  FilterList as FilterIcon,
  Refresh as RefreshIcon,
  AccessTime as TimeIcon,
  Star as StarIcon,
  Lock as LockIcon,
  PlayArrow as PlayIcon,
  MoreVert as MoreVertIcon,
  Share as ShareIcon,
  Favorite as FavoriteIcon,
  CalendarToday as CalendarIcon,
  Person as PersonIcon,
  Group as GroupIcon,
  EmojiEvents as TrophyIcon,
  MonetizationOn as MoneyIcon,
  LocalFireDepartment as FireIcon,
} from '@mui/icons-material';
import { Link, useNavigate } from 'react-router-dom';
import { styled } from '@mui/material/styles';

// Styled Components
const GradientPaper = styled(Paper)(({ theme }) => ({
  background: `linear-gradient(135deg, ${theme.palette.primary.dark} 0%, ${theme.palette.primary.main} 50%, ${alpha(theme.palette.primary.light, 0.8)} 100%)`,
  color: theme.palette.primary.contrastText,
  borderRadius: theme.shape.borderRadius * 3,
}));

const StyledCard = styled(Card)(({ theme }) => ({
  borderRadius: theme.shape.borderRadius * 2,
  transition: 'transform 0.2s, box-shadow 0.2s',
  '&:hover': {
    transform: 'translateY(-4px)',
    boxShadow: theme.shadows[8],
  },
}));

const RarityBadge = styled(Chip)(({ theme, rarity }) => {
  const colors = {
    Legendary: { bg: '#8B5CF6', color: 'white' },
    Rare: { bg: '#3B82F6', color: 'white' },
    Uncommon: { bg: '#10B981', color: 'white' },
    Common: { bg: '#9CA3AF', color: 'white' },
  };
  
  return {
    backgroundColor: colors[rarity]?.bg || '#9CA3AF',
    color: colors[rarity]?.color || 'white',
    fontWeight: 700,
    fontSize: '0.75rem',
  };
});

const CategoryChip = styled(Chip)(({ theme, categorycolor }) => ({
  backgroundColor: `${categorycolor}20`,
  color: categorycolor,
  borderColor: `${categorycolor}40`,
  fontWeight: 600,
}));

const SportIcon = ({ sport, ...props }) => {
  const icons = {
    NBA: <BasketballIcon {...props} />,
    NFL: <FootballIcon {...props} />,
    NHL: <HockeyIcon {...props} />,
    MLB: <BaseballIcon {...props} />,
  };
  return icons[sport] || <BasketballIcon {...props} />;
};

const SportChip = ({ sport, selected = false, onClick }) => {
  const colors = {
    NBA: '#EA580C',
    NFL: '#DC2626',
    NHL: '#3B82F6',
    MLB: '#16A34A',
  };

  return (
    <Chip
      icon={<SportIcon sport={sport} />}
      label={sport}
      onClick={onClick}
      sx={{
        backgroundColor: selected ? colors[sport] : 'grey.100',
        color: selected ? 'white' : 'text.secondary',
        borderColor: colors[sport],
        '&:hover': {
          backgroundColor: selected ? colors[sport] : `${colors[sport]}20`,
        },
      }}
    />
  );
};

// Secret Phrase Definitions Data
const SECRET_PHRASE_DEFINITIONS = [
  {
    id: 'advanced_1',
    category: 'Advanced Analytics & Models',
    title: 'Predictive Clustering',
    description: 'Uses unsupervised learning to cluster similar game scenarios and predict outcomes',
    rarity: 'Legendary',
    requiresPremium: true,
    sport: 'All',
    icon: <AnalyticsIcon />,
    secretCode: '26-PC',
    advancedProperty: 'predictive_clustering_analysis',
    color: '#6366F1',
  },
  {
    id: 'advanced_2',
    category: 'Advanced Analytics & Models',
    title: 'Bayesian Inference',
    description: 'Continuously updates probabilities with new information using Bayesian methods',
    rarity: 'Legendary',
    requiresPremium: true,
    sport: 'All',
    icon: <TrendingUpIcon />,
    secretCode: '26-BI',
    advancedProperty: 'bayesian_inference_models',
    color: '#6366F1',
  },
  {
    id: 'advanced_3',
    category: 'Advanced Analytics & Models',
    title: 'Gradient Boosted Models',
    description: 'Ensemble machine learning model that combines multiple weak predictors',
    rarity: 'Legendary',
    requiresPremium: true,
    sport: 'All',
    icon: <AnalyticsIcon />,
    secretCode: '26-GBM',
    advancedProperty: 'gradient_boosted_models',
    color: '#6366F1',
  },
  {
    id: 'injury_1',
    category: 'Advanced Injury Analytics',
    title: 'Injury Cascades',
    description: 'Predicts secondary injury impacts (player B gets more minutes, then fatigues and gets injured)',
    rarity: 'Rare',
    requiresPremium: true,
    sport: 'All',
    icon: <WarningIcon />,
    secretCode: '26-IC',
    advancedProperty: 'injury_cascade_prediction',
    color: '#EF4444',
  },
  {
    id: 'nhl_1',
    category: 'NHL-Specific Analytics',
    title: 'Goalie Fatigue',
    description: 'Tracks goalie workload and performance degradation with consecutive starts',
    rarity: 'Uncommon',
    requiresPremium: false,
    sport: 'NHL',
    icon: <HockeyIcon />,
    secretCode: '26-GF',
    advancedProperty: 'goalie_fatigue_index',
    color: '#3B82F6',
  },
];

const AI_PROMPT_EXAMPLES = {
  NBA: [
    "26-PC NBA SF LeBron James - Generate injury risk assessment",
    "26-BI NBA PF Anthony Davis - Analyze matchup clustering",
    "26-GBM NBA PG Stephen Curry - Predict three-point performance",
  ],
  NFL: [
    "26-PC NFL QB Patrick Mahomes - Predictive clustering analysis",
    "26-BI NFL WR Tyreek Hill - Bayesian inference on receptions",
    "26-GBM NFL RB Christian McCaffrey - Gradient boosted rushing yards",
  ],
  NHL: [
    "26-GF NHL G Connor Hellebuyck - Goalie fatigue index",
    "26-STR NHL C Connor McDavid - Special teams regression",
    "26-SQA NHL RW Auston Matthews - Shot quality analytics",
  ],
  MLB: [
    "26-PC MLB SP Shohei Ohtani - Predictive clustering analysis",
    "26-BI MLB RF Aaron Judge - Bayesian batting analysis",
    "26-GBM MLB CF Mike Trout - Gradient boosted performance",
  ],
};

const categories = ['all', 'Advanced Analytics & Models', 'Advanced Injury Analytics', 'NHL-Specific Analytics', 'Game Situation Analytics', 'Player-Specific Analytics', 'Market & Betting Analytics'];
const sports = ['NBA', 'NFL', 'NHL', 'MLB'];

// Main Component
const SecretPhraseScreen = () => {
  const theme = useTheme();
  const navigate = useNavigate();
  
  const [loading, setLoading] = useState(false);
  const [activeTab, setActiveTab] = useState(0);
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [selectedSport, setSelectedSport] = useState('NBA');
  const [searchQuery, setSearchQuery] = useState('');
  const [secretPhraseInput, setSecretPhraseInput] = useState('');
  const [generatedPrediction, setGeneratedPrediction] = useState('');
  const [showPremiumModal, setShowPremiumModal] = useState(false);
  const [selectedDefinition, setSelectedDefinition] = useState(null);
  const [searchHistory, setSearchHistory] = useState([]);
  const [showSearchHistory, setShowSearchHistory] = useState(false);
  const [isConnected, setIsConnected] = useState(true);

  // Mock analytics data
  const [analyticsStats] = useState({
    todaysStats: {
      todaysEvents: 42,
      todaysUnits: 18.5,
      accuracyRate: '72.4%',
    },
    recentEvents: [
      {
        id: 1,
        timestamp: new Date(),
        phraseCategory: 'Advanced Analytics & Models',
        phraseKey: 'Neural Network Ensemble',
        inputText: 'Predict Warriors vs Lakers outcome',
        rarity: 'legendary',
        sport: 'NBA',
        outcome: 'win',
        unitsWon: 3.5,
      },
      {
        id: 2,
        timestamp: new Date(Date.now() - 3600000),
        phraseCategory: 'Advanced Injury Analytics',
        phraseKey: 'Injury Propensity',
        inputText: 'LeBron James fatigue analysis',
        rarity: 'rare',
        sport: 'NBA',
        outcome: 'pending',
        unitsWon: null,
      },
    ],
  });

  useEffect(() => {
    // Simulate initial load
    const timer = setTimeout(() => {
      setLoading(false);
      setIsConnected(true);
    }, 1000);

    return () => clearTimeout(timer);
  }, []);

  const handleSearchSubmit = () => {
    if (searchQuery.trim()) {
      setSearchHistory(prev => [searchQuery, ...prev.slice(0, 9)]);
      setShowSearchHistory(false);
    }
  };

  const handleClearSearch = () => {
    setSearchQuery('');
    setShowSearchHistory(false);
  };

  const handleSecretPhraseGeneration = async () => {
    if (!secretPhraseInput.trim()) return;

    setLoading(true);
    // Simulate API call
    await new Promise(resolve => setTimeout(resolve, 1500));

    const prediction = `ðŸŽ¯ **Advanced Analysis**: Predictive Clustering\n\n
ðŸ“Š **Applied to**: LeBron James (SF - NBA)\n\n
ðŸ” **Analysis Type**: Uses unsupervised learning to cluster similar game scenarios\n\n
ðŸ“ˆ **Predicted Outcome**:\n
â€¢ Player clusters in top 15% for SF performance\n
â€¢ Similar historical patterns show 78% success rate\n
â€¢ Recommended bet: LeBron James over on main stat line\n\n
ðŸ’¡ **Insight**: Using Predictive Clustering model with NBA-specific parameters`;

    setGeneratedPrediction(prediction);
    setLoading(false);
  };

  const handleCopyToClipboard = (text) => {
    navigator.clipboard.writeText(text);
    // Show snackbar/toast
  };

  const filteredDefinitions = SECRET_PHRASE_DEFINITIONS.filter(definition => {
    const matchesSearch = !searchQuery || 
      definition.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
      definition.description.toLowerCase().includes(searchQuery.toLowerCase()) ||
      definition.category.toLowerCase().includes(searchQuery.toLowerCase()) ||
      definition.secretCode.toLowerCase().includes(searchQuery.toLowerCase());
    
    const matchesCategory = selectedCategory === 'all' || 
      definition.category === selectedCategory;
    
    return matchesSearch && matchesCategory;
  });

  const getCategoryColor = (category) => {
    const colors = {
      'Advanced Analytics & Models': '#6366F1',
      'Advanced Injury Analytics': '#EF4444',
      'NHL-Specific Analytics': '#3B82F6',
      'Game Situation Analytics': '#8B5CF6',
      'Player-Specific Analytics': '#10B981',
      'Market & Betting Analytics': '#F59E0B',
    };
    return colors[category] || '#6B7280';
  };

  const renderDefinitionCard = (definition) => (
    <StyledCard key={definition.id}>
      <CardContent>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
          <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>
            <Avatar sx={{ bgcolor: `${definition.color}20`, color: definition.color }}>
              {definition.icon}
            </Avatar>
            <Box>
              <Typography variant="h6" fontWeight="bold">
                {definition.title}
              </Typography>
              <CategoryChip
                label={definition.category}
                size="small"
                categorycolor={getCategoryColor(definition.category)}
              />
            </Box>
          </Box>
          <IconButton
            onClick={() => {
              setSecretPhraseInput(definition.secretCode);
              setActiveTab(1); // Switch to generator tab
            }}
          >
            <KeyIcon sx={{ color: definition.color }} />
          </IconButton>
        </Box>

        <Typography variant="body2" color="text.secondary" sx={{ mb: 2 }}>
          {definition.description}
        </Typography>

        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 2 }}>
          <Chip
            icon={<KeyIcon />}
            label={definition.secretCode}
            size="small"
            sx={{
              bgcolor: 'grey.100',
              color: 'primary.main',
              fontFamily: 'monospace',
            }}
          />
          <RarityBadge
            label={definition.rarity}
            size="small"
            rarity={definition.rarity}
          />
        </Box>

        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
            <SportIcon sport={definition.sport.split(',')[0].trim()} fontSize="small" />
            <Typography variant="caption" color="text.secondary">
              {definition.sport}
            </Typography>
          </Box>
          
          <Button
            startIcon={definition.requiresPremium ? <LockIcon /> : <PlayIcon />}
            variant={definition.requiresPremium ? "outlined" : "contained"}
            size="small"
            onClick={() => {
              if (definition.requiresPremium) {
                setSelectedDefinition(definition);
                setShowPremiumModal(true);
              } else {
                setSecretPhraseInput(definition.secretCode);
                setActiveTab(1);
              }
            }}
          >
            {definition.requiresPremium ? 'Premium' : 'Use'}
          </Button>
        </Box>
      </CardContent>
    </StyledCard>
  );

  const renderAIGenerator = () => (
    <Box>
      <Paper sx={{ p: 3, mb: 3 }}>
        <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
          <SparklesIcon sx={{ color: 'primary.main', mr: 1 }} />
          <Typography variant="h5" fontWeight="bold">
            Secret Phrase Generator
          </Typography>
        </Box>
        
        <Typography variant="body2" color="text.secondary" sx={{ mb: 3 }}>
          Enter a secret phrase starting with "26-" followed by sport, position, and player name.
        </Typography>

        {/* Sport Selection */}
        <Box sx={{ mb: 3 }}>
          <Typography variant="subtitle2" fontWeight="600" sx={{ mb: 1 }}>
            Select Sport
          </Typography>
          <Stack direction="row" spacing={1}>
            {sports.map(sport => (
              <SportChip
                key={sport}
                sport={sport}
                selected={selectedSport === sport}
                onClick={() => setSelectedSport(sport)}
              />
            ))}
          </Stack>
        </Box>

        {/* Secret Phrase Input */}
        <Box sx={{ mb: 3 }}>
          <TextField
            fullWidth
            label="Secret Phrase"
            placeholder="Example: 26-PC NBA SF LeBron James"
            value={secretPhraseInput}
            onChange={(e) => setSecretPhraseInput(e.target.value)}
            multiline
            rows={3}
            InputProps={{
              startAdornment: (
                <InputAdornment position="start">
                  <KeyIcon />
                </InputAdornment>
              ),
            }}
            helperText="Format: 26-CODE SPORT POSITION PLAYER_NAME"
          />
        </Box>

        <Button
          fullWidth
          variant="contained"
          size="large"
          startIcon={<RocketIcon />}
          onClick={handleSecretPhraseGeneration}
          disabled={loading || !secretPhraseInput.trim()}
          sx={{ mb: 3 }}
        >
          {loading ? <CircularProgress size={24} /> : 'Generate Prediction'}
        </Button>

        {generatedPrediction && (
          <Paper sx={{ p: 2, bgcolor: 'success.light', border: 1, borderColor: 'success.main', mb: 3 }}>
            <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 1 }}>
              <Typography variant="h6" fontWeight="bold">
                Generated Analysis
              </Typography>
              <IconButton size="small" onClick={() => handleCopyToClipboard(generatedPrediction)}>
                <CopyIcon />
              </IconButton>
            </Box>
            <Typography variant="body2" sx={{ whiteSpace: 'pre-line' }}>
              {generatedPrediction}
            </Typography>
          </Paper>
        )}

        {/* Example Prompts */}
        <Box>
          <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
            <LightbulbIcon sx={{ color: 'warning.main', mr: 1 }} />
            <Typography variant="h6" fontWeight="bold">
              Example Secret Phrases
            </Typography>
          </Box>
          
          <Stack spacing={1}>
            {AI_PROMPT_EXAMPLES[selectedSport]?.map((prompt, index) => (
              <Chip
                key={index}
                label={prompt}
                onClick={() => setSecretPhraseInput(prompt)}
                variant="outlined"
                sx={{ justifyContent: 'flex-start', fontFamily: 'monospace' }}
              />
            ))}
          </Stack>
        </Box>
      </Paper>
    </Box>
  );

  const renderActivity = () => (
    <Box>
      <Paper sx={{ p: 3, mb: 3 }}>
        <Box sx={{ display: 'flex', alignItems: 'center', mb: 3 }}>
          <TimeIcon sx={{ color: 'success.main', mr: 1 }} />
          <Typography variant="h5" fontWeight="bold">
            Recent Analytics Activity
          </Typography>
        </Box>

        <Timeline position="alternate">
          {analyticsStats.recentEvents.map((event) => (
            <TimelineItem key={event.id}>
              <TimelineOppositeContent color="text.secondary">
                {new Date(event.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
              </TimelineOppositeContent>
              <TimelineSeparator>
                <TimelineDot color={event.outcome === 'win' ? 'success' : event.outcome === 'loss' ? 'error' : 'warning'}>
                  {event.outcome === 'win' ? <CheckCircleIcon /> : event.outcome === 'loss' ? <CloseIcon /> : <InfoIcon />}
                </TimelineDot>
                <TimelineConnector />
              </TimelineSeparator>
              <TimelineContent>
                <Paper elevation={3} sx={{ p: 2 }}>
                  <Typography variant="subtitle2" fontWeight="bold">
                    {event.phraseKey}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {event.phraseCategory}
                  </Typography>
                  <Box sx={{ display: 'flex', alignItems: 'center', mt: 1 }}>
                    <SportIcon sport={event.sport} fontSize="small" />
                    <Typography variant="caption" sx={{ ml: 0.5 }}>
                      {event.sport}
                    </Typography>
                    <Chip
                      label={event.outcome?.toUpperCase() || 'PENDING'}
                      size="small"
                      sx={{ ml: 1 }}
                      color={event.outcome === 'win' ? 'success' : event.outcome === 'loss' ? 'error' : 'warning'}
                    />
                  </Box>
                </Paper>
              </TimelineContent>
            </TimelineItem>
          ))}
        </Timeline>
      </Paper>
    </Box>
  );

  if (loading && !analyticsStats) {
    return (
      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>
        <CircularProgress />
      </Box>
    );
  }

  return (
    <Container maxWidth="lg">
      {/* Hero Header */}
      <GradientPaper sx={{ mb: 4, mt: 2, p: 4, position: 'relative', overflow: 'hidden' }}>
        <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', mb: 2 }}>
          <Button
            component={Link}
            to="/"
            startIcon={<ArrowBackIcon />}
            sx={{ color: 'white' }}
          >
            Back
          </Button>
          
          <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
            <Badge
              color={isConnected ? 'success' : 'error'}
              variant="dot"
              anchorOrigin={{
                vertical: 'top',
                horizontal: 'right',
              }}
            >
              <Avatar sx={{ bgcolor: 'rgba(255,255,255,0.2)', width: 40, height: 40 }}>
                <AnalyticsIcon />
              </Avatar>
            </Badge>
            <Typography variant="body2" sx={{ color: 'rgba(255,255,255,0.9)' }}>
              {isConnected ? 'AI Models Active â€¢ Live Data' : 'Connection Offline'}
            </Typography>
          </Box>
        </Box>

        <Box sx={{ textAlign: 'center', mb: 3 }}>
          <Typography variant="h2" fontWeight="bold" sx={{ color: 'white', mb: 1 }}>
            Secret Phrase Analytics
          </Typography>
          <Typography variant="subtitle1" sx={{ color: 'rgba(255,255,255,0.9)' }}>
            Advanced AI-powered analytics and predictive models for professional sports betting insights
          </Typography>
        </Box>

        {/* Search Bar */}
        <Paper sx={{ mb: 3, position: 'relative' }}>
          <TextField
            fullWidth
            placeholder="Search secret phrases..."
            value={searchQuery}
            onChange={(e) => setSearchQuery(e.target.value)}
            onFocus={() => setShowSearchHistory(true)}
            InputProps={{
              startAdornment: (
                <InputAdornment position="start">
                  <SearchIcon />
                </InputAdornment>
              ),
              endAdornment: searchQuery && (
                <InputAdornment position="end">
                  <IconButton size="small" onClick={handleClearSearch}>
                    <CloseIcon />
                  </IconButton>
                </InputAdornment>
              ),
            }}
          />
          
          {showSearchHistory && searchHistory.length > 0 && (
            <Paper sx={{ position: 'absolute', top: '100%', left: 0, right: 0, zIndex: 10, mt: 1 }}>
              <List dense>
                {searchHistory.map((item, index) => (
                  <ListItem
                    key={index}
                    button
                    onClick={() => {
                      setSearchQuery(item);
                      setShowSearchHistory(false);
                    }}
                  >
                    <ListItemIcon>
                      <TimeIcon fontSize="small" />
                    </ListItemIcon>
                    <ListItemText primary={item} />
                  </ListItem>
                ))}
              </List>
            </Paper>
          )}
        </Paper>

        {/* Stats */}
        <Grid container spacing={2} sx={{ mb: 2 }}>
          <Grid item xs={12} sm={4}>
            <Paper sx={{ p: 2, textAlign: 'center', bgcolor: 'rgba(255,255,255,0.1)', color: 'white' }}>
              <FlashIcon sx={{ mb: 1 }} />
              <Typography variant="h4" fontWeight="bold">
                {analyticsStats.todaysStats.todaysEvents}
              </Typography>
              <Typography variant="caption">Today's Events</Typography>
            </Paper>
          </Grid>
          <Grid item xs={12} sm={4}>
            <Paper sx={{ p: 2, textAlign: 'center', bgcolor: 'rgba(255,255,255,0.1)', color: 'white' }}>
              <TrendingUpIcon sx={{ mb: 1 }} />
              <Typography variant="h4" fontWeight="bold">
                +{analyticsStats.todaysStats.todaysUnits}u
              </Typography>
              <Typography variant="caption">Units Gained</Typography>
            </Paper>
          </Grid>
          <Grid item xs={12} sm={4}>
            <Paper sx={{ p: 2, textAlign: 'center', bgcolor: 'rgba(255,255,255,0.1)', color: 'white' }}>
              <StatsIcon sx={{ mb: 1 }} />
              <Typography variant="h4" fontWeight="bold">
                {analyticsStats.todaysStats.accuracyRate}
              </Typography>
              <Typography variant="caption">Accuracy Rate</Typography>
            </Paper>
          </Grid>
        </Grid>
      </GradientPaper>

      {/* Main Tabs */}
      <Paper sx={{ mb: 3 }}>
        <Tabs
          value={activeTab}
          onChange={(e, newValue) => setActiveTab(newValue)}
          variant="fullWidth"
          sx={{
            '& .MuiTab-root': {
              fontWeight: 600,
            },
          }}
        >
          <Tab icon={<BookIcon />} label="Definitions" />
          <Tab icon={<SparklesIcon />} label="AI Generator" />
          <Tab icon={<HistoryIcon />} label="Activity" />
        </Tabs>
      </Paper>

      {/* Tab Content */}
      {activeTab === 0 && (
        <Box>
          {/* Category Filter */}
          <Paper sx={{ p: 2, mb: 3 }}>
            <Typography variant="subtitle2" fontWeight="600" sx={{ mb: 1 }}>
              Filter by Category
            </Typography>
            <Stack direction="row" spacing={1} sx={{ flexWrap: 'wrap', gap: 1 }}>
              {categories.map(category => (
                <Chip
                  key={category}
                  label={category === 'all' ? 'All Categories' : category.split(' ')[0]}
                  onClick={() => setSelectedCategory(category)}
                  color={selectedCategory === category ? 'primary' : 'default'}
                  variant={selectedCategory === category ? 'filled' : 'outlined'}
                />
              ))}
            </Stack>
          </Paper>

          {/* Search Results Info */}
          {searchQuery && (
            <Alert
              severity="info"
              action={
                <Button color="inherit" size="small" onClick={handleClearSearch}>
                  Clear
                </Button>
              }
              sx={{ mb: 3 }}
            >
              Search results for "{searchQuery}" ({filteredDefinitions.length} found)
            </Alert>
          )}

          {/* Definitions Grid */}
          <Grid container spacing={3}>
            {filteredDefinitions.length > 0 ? (
              filteredDefinitions.map(definition => (
                <Grid item xs={12} sm={6} md={4} key={definition.id}>
                  {renderDefinitionCard(definition)}
                </Grid>
              ))
            ) : (
              <Grid item xs={12}>
                <Paper sx={{ p: 4, textAlign: 'center' }}>
                  <SearchIcon sx={{ fontSize: 48, color: 'text.disabled', mb: 2 }} />
                  <Typography variant="h6" color="text.secondary" gutterBottom>
                    No secret phrases match your search
                  </Typography>
                  <Button variant="outlined" onClick={handleClearSearch}>
                    Clear Search
                  </Button>
                </Paper>
              </Grid>
            )}
          </Grid>
        </Box>
      )}

      {activeTab === 1 && renderAIGenerator()}
      {activeTab === 2 && renderActivity()}

      {/* Footer */}
      <Paper sx={{ p: 3, mt: 4, textAlign: 'center' }}>
        <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'center', mb: 2 }}>
          <ShieldIcon sx={{ color: 'primary.main', mr: 1 }} />
          <Typography variant="h6" fontWeight="bold">
            Enterprise-Grade Analytics
          </Typography>
        </Box>
        <Typography variant="body2" color="text.secondary">
          Powered by proprietary AI models, real-time data feeds, and advanced statistical analysis.
        </Typography>
      </Paper>

      {/* Premium Modal */}
      <Dialog
        open={showPremiumModal}
        onClose={() => setShowPremiumModal(false)}
        maxWidth="sm"
        fullWidth
      >
        <DialogTitle sx={{ bgcolor: 'primary.main', color: 'white' }}>
          <Box sx={{ display: 'flex', alignItems: 'center' }}>
            <DiamondIcon sx={{ mr: 1 }} />
            Premium Feature Required
          </Box>
        </DialogTitle>
        <DialogContent sx={{ p: 3 }}>
          {selectedDefinition && (
            <>
              <Box sx={{ display: 'flex', alignItems: 'center', mb: 3 }}>
                <Avatar sx={{ bgcolor: `${getCategoryColor(selectedDefinition.category)}20`, mr: 2 }}>
                  {selectedDefinition.icon}
                </Avatar>
                <Box>
                  <Typography variant="h6" fontWeight="bold">
                    {selectedDefinition.title}
                  </Typography>
                  <Typography variant="caption" color="text.secondary">
                    {selectedDefinition.category}
                  </Typography>
                </Box>
              </Box>

              <Typography paragraph>
                {selectedDefinition.description}
              </Typography>

              <Alert severity="info" sx={{ mb: 3 }}>
                This advanced analytics feature requires a premium subscription to access.
              </Alert>

              <Paper sx={{ p: 2, mb: 3 }}>
                <Typography variant="subtitle2" fontWeight="bold" gutterBottom>
                  Premium Benefits
                </Typography>
                <List dense>
                  <ListItem>
                    <ListItemIcon>
                      <CheckCircleIcon color="success" />
                    </ListItemIcon>
                    <ListItemText primary="Access to all secret phrases" />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon>
                      <CheckCircleIcon color="success" />
                    </ListItemIcon>
                    <ListItemText primary="Unlimited AI predictions" />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon>
                      <CheckCircleIcon color="success" />
                    </ListItemIcon>
                    <ListItemText primary="Real-time data feeds" />
                  </ListItem>
                  <ListItem>
                    <ListItemIcon>
                      <CheckCircleIcon color="success" />
                    </ListItemIcon>
                    <ListItemText primary="Priority support" />
                  </ListItem>
                </List>
              </Paper>
            </>
          )}
        </DialogContent>
        <DialogActions sx={{ p: 2 }}>
          <Button onClick={() => setShowPremiumModal(false)}>
            Cancel
          </Button>
          <Button variant="contained" color="primary">
            Upgrade to Premium
          </Button>
        </DialogActions>
      </Dialog>

      {/* Floating Action Button for Quick Access */}
      <Fab
        color="primary"
        sx={{ position: 'fixed', bottom: 16, right: 16 }}
        onClick={() => setActiveTab(1)}
      >
        <SparklesIcon />
      </Fab>
    </Container>
  );
};

export default SecretPhraseScreen;
